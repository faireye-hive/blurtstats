<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title data-i18n="Blurt Rewards Dashboard">Blurt Rewards Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/modern-normalize/modern-normalize.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <h1 data-i18n="Blurt Rewards Dashboard">Blurt Rewards Dashboard</h1>
      <div class="small" data-i18n="Últimos 30 dias — recompensas recebidas e estimativas de pending (próx. 7 dias)">Últimos 30 dias — recompensas recebidas e estimativas de pending (próx. 7 dias)</div>
      
      <div class="lang-selector">
          <label class="small" data-i18n="Idioma:" for="langSelect">Idioma:</label>
          <select id="langSelect">
            <option value="en">English (EN)</option>
            <option value="de">Deutsch (DE)</option>
            <option value="es">Español (ES)</option>
            <option value="fr">Français (FR)</option>
            <option value="pl">Polski (PL)</option>
            <option value="pt">Português (PT)</option>
            <option value="ja">日本語 (JA)</option>
            <option value="zh">中文 (ZH)</option>
          </select>
            <select id="currencySelect">
            <option value="en" selected data-i18n="USD">USD</option>
            <option value="de" data-i18n="EUR">EUR</option>
            <option value="pt" data-i18n="BRL">BRL</option>
            <option value="pl" data-i18n="PLN">PLN</option>
            <option value="ja" data-i18n="JPY">JPY</option>
            <option value="zh" data-i18n="RMB">CNY</option>
        </select>
      </div>

    </header>

    <div class="controls card">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <label class="small" data-i18n="Conta:">Conta:</label>
        <input 
        id="accountInput" 
        value="bgo" 
        placeholder="ex: seuusuario"
        data-i18n-placeholder="Username" 
    />
        
        <label class="small" data-i18n="RPC / nodo:">RPC / nodo:</label>
        <select id="rpcSelect">
            <option value="https://rpc.blurt.world">https://rpc.blurt.world</option>
            <option value="https://blurt-rpc.saboin.com">https://blurt-rpc.saboin.com</option>
            <option value="https://rpc.beblurt.com">https://rpc.beblurt.com</option>
            <option value="https://blurtrpc.dagobert.uk">https://blurtrpc.dagobert.uk</option>
            <option value="custom" data-i18n="Custom...">Custom...</option>
        </select>
        <input id="rpcCustomInput" style="display:none;" placeholder="https://seu-nodo-custom.com" />
        
        <button id="fetchBtn" data-i18n="Buscar">Buscar</button>
        <div style="margin-left:auto" class="example" data-i18n="Dica: aumente limite se tiver muitas postagens">Dica: aumente limite se tiver muitas postagens</div>
      </div>
      <div style="margin-top:8px" class="small" data-i18n="Este site usa as chamadas JSON-RPC da API &quot;condenser_api&quot; (get_account_history, get_discussions_by_blog, get_content). Configure o RPC caso o padrão não funcione.">Este site usa as chamadas JSON-RPC da API "condenser_api" (get_account_history, get_discussions_by_blog, get_content). Configure o RPC caso o padrão não funcione.</div>
    </div>

<div class="grid">
  <div>
    <div class="card" id="summaryCard" style="margin-bottom:16px;">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong data-i18n="Resumo (30 dias)">Resumo (30 dias)</strong>
          <div class="small" data-i18n="Atualizado:">Atualizado: <span id="updatedAt">—</span></div>
        </div>
        <ul class="stats" style="margin-top:12px">
          <li>
            <div class="small" data-i18n="Curation recebido">Curation recebido</div>
            <div id="totalCuration" style="font-weight:700;font-size:18px">—</div>
          </li>
          <li>
            <div class="small" data-i18n="Author recebido">Author recebido</div>
            <div id="totalAuthor" style="font-weight:700;font-size:18px">—</div>
          </li>
          <li>
            <div class="small" data-i18n="Pending author (7d)">Pending author (7d)</div>
            <div id="pendingAuthor" style="font-weight:700;font-size:18px">—</div>
          </li>
          <li>
            <div class="small" data-i18n="Estimated pending curation (7d)">Estimated pending curation (7d)</div>
            <div id="pendingCuration" style="font-weight:700;font-size:18px">—</div>
          </li>
        </ul>

        <div style="margin-top:12px"><small class="small" data-i18n="Legenda">Legenda</small>
          <div class="legend" style="margin-top:6px">
            <div class="item"><span class="dot" style="background:#60a5fa"></span> <span data-i18n="Curation (received)">Curation (received)</span></div>
            <div class="item"><span class="dot" style="background:#34d399"></span> <span data-i18n="Author (received)">Author (received)</span></div>
            <div class="item"><span class="dot" style="background:#fbbf24"></span> <span data-i18n="Curation pending (estimativa diária 7d)">Curation pending (estimativa diária 7d)</span></div> 
            <div class="item"><span class="dot" style="background:#fbbf24"></span> <span data-i18n="Pending author (7d)">Pending author (7d)</span></div>
          </div>
        </div>

        <div class="chart-wrap" style="margin-top:14px"><canvas id="rewardsChart" aria-label="gráfico de recompensas"></canvas></div>
    </div>
    
    <div class="card" style="margin-bottom:16px;">
        <div style="display:flex; justify-content:space-between; gap:20px; flex-wrap: wrap;">
            <div style="flex: 1;">
                <strong data-i18n="Votantes (Quem votou em você - 30d)">Votantes (Quem votou em você - 30d)</strong>
                <ol id="votersList" class="compact-list" style="margin-top:8px">
                    <li>...</li>
                </ol>
            </div>
            <div style="flex: 1;">
                <strong data-i18n="Seus Últimos Votos (7d)">Seus Últimos Votos (7d)</strong>
                <ol id="votesGivenList" class="compact-list" style="margin-top:8px">
                    <li>...</li>
                </ol>
            </div>
        </div>
    </div>

    <div class="card" style="margin-bottom:16px;">
        <div style="display:flex; justify-content:space-between; gap:20px; flex-wrap: wrap;">
            <div style="flex: 1;">
                <strong data-i18n="Top Commenters (Quem comentou em você - 30d)">Top Commenters (Quem comentou em você - 30d)</strong>
                <ol id="commentersList" class="compact-list" style="margin-top:8px">
                    <li>...</li>
                </ol>
            </div>
            <div style="flex: 1;">
                <strong data-i18n="Top Comentados (Para quem você comentou - 30d)">Top Comentados (Para quem você comentou - 30d)</strong>
                <ol id="commentsGivenList" class="compact-list" style="margin-top:8px">
                    <li>...</li>
                </ol>
            </div>
        </div>
    </div>
  </div>

  <div>
    <div class="card" style="margin-bottom:16px;">
        <strong data-i18n="Estatísticas da Conta">Estatísticas da Conta (@<span id="accountDisplay">...</span>)</strong>
        <ul class="stats" style="margin-top:12px">
            <li>
                <div class="small" data-i18n="Voting Power (VP)">Voting Power (VP)</div>
                <div id="votingPower" style="font-weight:700;font-size:18px">—</div>
            </li>
            <li>
                <div class="small" data-i18n="Blurt Power (BP)">Blurt Power (BP)</div>
                <div id="blurtPower" style="font-weight:700;font-size:18px">—</div>
            </li>
            <li>
                <div class="small" data-i18n="Blurt Líquido">Blurt Líquido</div>
                <div id="blurtLiquid" style="font-weight:700;font-size:18px">—</div>
            </li>
            <li>
                <div class="small" data-i18n="APR Estimado (Curation 7d)">APR Estimado (Curation 7d)</div>
                <div id="aprDisplay" style="font-weight:700;font-size:18px">—</div>
            </li>
        </ul>
    </div>

    <div class="card" style="margin-bottom:16px;">
        <strong data-i18n="Logs">Logs</strong>
        <pre id="log" style="max-height:220px;overflow:auto;background:transparent;border:none;color:var(--muted)"></pre>
    </div>

    <div class="card" style="margin-bottom:16px;">
      <strong data-i18n="Config & detalhes">Config & detalhes</strong>
      <div class="small" style="margin-top:8px" data-i18n="Opções e notas técnicas">Opções e notas técnicas</div>
      <ol class="small" style="margin-top:10px">
        <li data-i18n="Busca histórico de operações (get_account_history) para extrair curation_reward e author_reward.">Busca histórico de operações (get_account_history) para extrair <code>curation_reward</code> e <code>author_reward</code>.</li>
        <li data-i18n="Busca posts recentes via get_discussions_by_blog (limit configurable) e usa get_content para ler pending_payout_value e cashout_time.">Busca posts recentes via <code>get_discussions_by_blog</code> (limit configurable) e usa <code>get_content</code> para ler <code>pending_payout_value</code> e <code>cashout_time</code>.</li>
        <li data-i18n="Estimativa de pending curation: usa fator de curation_ratio (padrão 25%). Isso é apenas uma estimativa — cálculo real depende dos votos e regras da rede.">Estimativa de pending curation: usa fator de curation_ratio (padrão 25%). Isso é apenas uma estimativa — cálculo real depende dos votos e regras da rede.</li>
      </ol>

      <div style="margin-top:10px">
        <label class="small" data-i18n="Limite de posts (get_discussions_by_blog)">Limite de posts (get_discussions_by_blog)</label>
        <input id="postLimit" type="number" min="10" max="200" value="100" />
      </div>

      <div style="margin-top:10px"><button id="exportCsv" data-i18n="Exportar CSV (30 dias)">Exportar CSV (30 dias)</button></div>
    </div>

    <div class="card">
      <strong data-i18n="Como usar">Como usar</strong>
      <ol class="small">
        <li data-i18n="Informe sua conta e um RPC funcional.">Informe sua conta e um RPC funcional.</li>
        <li data-i18n="Clique em Buscar. Aguarde os requests (pode demorar se limite grande).">Clique em <em>Buscar</em>. Aguarde os requests (pode demorar se limite grande).</li>
        <li data-i18n="Os gráficos serão preenchidos com as somas diárias dos últimos 30 dias.">Os gráficos serão preenchidos com as somas diárias dos últimos 30 dias.</li>
      </ol>
      <div style="margin-top:8px" class="warn" data-i18n="Aviso: dependendo do RPC, algumas chamadas podem falhar por limite de taxa — troque o endpoint se necessário.">Aviso: dependendo do RPC, algumas chamadas podem falhar por limite de taxa — troque o endpoint se necessário.</div>
    </div>
  </div>
</div>

    <footer class="small" data-i18n="Feito rápido — sinta-se livre para pedir ajustes (cores, fontes, algoritmo de estimativa etc.).">Feito rápido — sinta-se livre para pedir ajustes (cores, fontes, algoritmo de estimativa etc.).</footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@blurtfoundation/blurtjs@latest/dist/blurt.min.js" integrity="sha384-zAI8cEC42mrdg7eYmWIBrq/4dlEyQs0KgbXbI20wQo91MENslp5+bkSBGJynlR1t" crossorigin="anonymous"></script>
  <script type="module" src="app.js"></script>
</body>
</html>