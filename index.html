<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blurt Rewards Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/modern-normalize/modern-normalize.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <h1>Blurt Rewards Dashboard</h1>
      <div class="small">Últimos 30 dias — recompensas recebidas e estimativas de pending (próx. 7 dias)</div>
    </header>

    <div class="controls card">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <label class="small">Conta:</label>
        <input id="accountInput" value="bgo" placeholder="ex: seuusuario" />
        <label class="small">RPC / nodo:</label>
        <input id="rpcInput" style="min-width:360px" value="https://rpc.blurt.world" placeholder="https://rpc.blurt.world (ou outro)" />
        <button id="fetchBtn">Buscar</button>
        <div style="margin-left:auto" class="example">Dica: aumente limite se tiver muitas postagens</div>
      </div>
      <div style="margin-top:8px" class="small">Este site usa as chamadas JSON-RPC da API "condenser_api" (get_account_history, get_discussions_by_blog, get_content). Configure o RPC caso o padrão não funcione.</div>
    </div>

    <div class="grid">
      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Resumo (30 dias)</strong>
            <div class="small">Atualizado: <span id="updatedAt">—</span></div>
          </div>
          <ul class="stats" style="margin-top:12px">
            <li>
              <div class="small">Curation recebido</div>
              <div id="totalCuration" style="font-weight:700;font-size:18px">—</div>
            </li>
            <li>
              <div class="small">Author recebido</div>
              <div id="totalAuthor" style="font-weight:700;font-size:18px">—</div>
            </li>
            <li>
              <div class="small">Pending author (7d)</div>
              <div id="pendingAuthor" style="font-weight:700;font-size:18px">—</div>
            </li>
            <li>
              <div class="small">Estimated pending curation (7d)</div>
              <div id="pendingCuration" style="font-weight:700;font-size:18px">—</div>
            </li>
          </ul>

          <div style="margin-top:12px"><small class="small">Legenda</small>
            <div class="legend" style="margin-top:6px">
              <div class="item"><span class="dot" style="background:#60a5fa"></span> Curation</div>
              <div class="item"><span class="dot" style="background:#34d399"></span> Author</div>
              <div class="item"><span class="dot" style="background:#fbbf24"></span> Pending author (7d)</div>
            </div>
          </div>

          <div class="chart-wrap" style="margin-top:14px"><canvas id="rewardsChart" aria-label="gráfico de recompensas"></canvas></div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Logs</strong>
          <pre id="log" style="max-height:220px;overflow:auto;background:transparent;border:none;color:var(--muted)"></pre>
        </div>
      </div>

      <div>
        <div class="card">
          <strong>Config & detalhes</strong>
          <div class="small" style="margin-top:8px">Opções e notas técnicas</div>
          <ol class="small" style="margin-top:10px">
            <li>Busca histórico de operações (get_account_history) para extrair <code>curation_reward</code> e <code>author_reward</code>.</li>
            <li>Busca posts recentes via <code>get_discussions_by_blog</code> (limit configurable) e usa <code>get_content</code> para ler <code>pending_payout_value</code> e <code>cashout_time</code>.</li>
            <li>Estimativa de pending curation: usa fator de curation_ratio (padrão 25%). Isso é apenas uma estimativa — cálculo real depende dos votos e regras da rede.</li>
          </ol>

          <div style="margin-top:10px">
            <label class="small">Limite de posts (get_discussions_by_blog)</label>
            <input id="postLimit" type="number" min="10" max="200" value="100" />
          </div>

          <div style="margin-top:10px"><button id="exportCsv">Exportar CSV (30 dias)</button></div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Como usar</strong>
          <ol class="small">
            <li>Informe sua conta e um RPC funcional.</li>
            <li>Clique em <em>Buscar</em>. Aguarde os requests (pode demorar se limite grande).</li>
            <li>Os gráficos serão preenchidos com as somas diárias dos últimos 30 dias.</li>
          </ol>
          <div style="margin-top:8px" class="warn">Aviso: dependendo do RPC, algumas chamadas podem falhar por limite de taxa — troque o endpoint se necessário.</div>
        </div>
      </div>
    </div>

    <footer class="small">Feito rápido — sinta-se livre para pedir ajustes (cores, fontes, algoritmo de estimativa etc.).</footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@blurtfoundation/blurtjs@latest/dist/blurt.min.js" integrity="sha384-zAI8cEC42mrdg7eYmWIBrq/4dlEyQs0KgbXbI20wQo91MENslp5+bkSBGJynlR1t" crossorigin="anonymous"></script>
  <script type="module" src="app.js"></script>
</body>
</html>